--I first want to explore how many occupations there are, how many males, how many females, types of disorders etc. 
select count(gender) from sleep
where gender = 'Male'
select count(gender) from sleep
where gender = 'Female'
select occupation from sleep
group by occupation
select sleepdisorder from sleep
group by sleepdisorder

--Since stresslevel, sleepquality, activitylevel are numeric values, I want to look at their max and min values.
select 
   max(sleepquality:: numeric) as maxsleepquality,
max(activitylevel:: numeric) as maxactivitylevel,
max(stresslevel:: numeric) as maxstresslevel
from sleep
select 
   min(sleepquality:: numeric) as maxsleepquality,
min(activitylevel:: numeric) as maxactivitylevel,
min(stresslevel:: numeric) as maxstresslevel
from sleep

select * from sleep

--Now I want to explore what percentage of males and females are insomniac, have sleep apnea, or do not have any disorders.
SELECT  gender,
    COUNT(CASE WHEN sleepdisorder = 'Insomnia' THEN 1 END) AS insomnia_count,
 ROUND((COUNT(CASE WHEN sleepdisorder = 'Insomnia' THEN 1 END) * 100.0 / COUNT(*)), 2) 
	AS insomnia_percentage
FROM sleep
   GROUP BY 
     gender;

SELECT 
    gender, 
    COUNT(CASE WHEN sleepdisorder = 'None' THEN 1 END) AS none_count,
    ROUND((COUNT(CASE WHEN sleepdisorder = 'None' THEN 1 END) * 100.0 / COUNT(*)), 2) AS nodisorder_percentage
FROM 
    sleep
GROUP BY 
    gender;

SELECT 
    gender, 
    COUNT(CASE WHEN sleepdisorder = 'Sleep Apnea' THEN 1 END) AS apnea_count,
    Round((COUNT(CASE WHEN sleepdisorder = 'Sleep Apnea' THEN 1 END) * 100.0 / COUNT(*)), 2) AS apnea_percentage
FROM 
    sleep
GROUP BY 
    gender;

------ Exploring the average stress level per occupation
select * from sleep

SELECT 
    occupation,
    ROUND(AVG(stresslevel:: numeric), 1) AS avg_stress
FROM 
    sleep
GROUP BY 
    occupation
order by avg_stress desc
-- Exploring the average stress level per occupation and per gender
SELECT 
    occupation,
    ROUND(AVG(CASE WHEN gender = 'Female' THEN stresslevel::numeric ELSE NULL END), 1) AS avg_stress_female
FROM 
    sleep
GROUP BY 
    occupation;

SELECT 
    occupation,
    ROUND(AVG(CASE WHEN gender = 'Male' THEN stresslevel::numeric ELSE NULL END), 1) AS avg_stress_Male
FROM 
    sleep
GROUP BY 
    occupation;

--I also wonder the relationship between occupation and sleepduration. 

select occupation, sleepquality,
round(avg(sleepduration:: numeric)) AS avgsleep
from sleep
group by occupation, sleepquality
order by avgsleep desc
-- comparing with the query I have done a couple lines up, occupations with the least stresslevel sleep the most.
--their sleep qualities are also consistent.

select * from sleep

-- Now I want to look at if there is a relationship between activity level and sleep quality

select occupation, round(avg(activitylevel:: numeric)) as avgactivity, 
	round(avg(sleepquality:: numeric)) as avgsleepquality
from sleep
group by occupation
order by avgactivity desc


---bmis per occupation

SELECT 
    occupation,
    COUNT(CASE WHEN bmi = 'Obese' THEN 1 END) AS obese_count,
    COUNT(*) AS total_count,
    (COUNT(CASE WHEN bmi = 'Obese' THEN 1 END) * 100.0 / COUNT(*)) AS obese_percentage
FROM 
    sleep
GROUP BY 
    occupation;


SELECT 
    occupation,
    COUNT(CASE WHEN bmi LIKE '%Normal%' THEN 1 END) AS normal_count,
    COUNT(*) AS total_count,
    (COUNT(CASE WHEN bmi LIKE '%Normal%' THEN 1 END) * 100.0 / COUNT(*)) AS normal_percentage
FROM 
    sleep
GROUP BY 
    occupation;


SELECT 
    occupation,
    COUNT(CASE WHEN bmi LIKE 'Overweight' THEN 1 END) AS overweight_count,
    COUNT(*) AS total_count,
    (COUNT(CASE WHEN bmi LIKE 'Overweight' THEN 1 END) * 100.0 / COUNT(*)) AS overweight_percentage
FROM 
    sleep
GROUP BY 
    occupation;

--- average age per occupation
select occupation, round(avg(age))
	from sleep
group by occupation

--stress level per age
select age, round(avg(stresslevel:: numeric),1) as avgstress
from sleep
group by age
order by avgstress desc

---What percentage of each occupation have a certain sleep disorder
SELECT 
    occupation,
    sleepdisorder,
    COUNT(*) AS disorder_count,
    round(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (PARTITION BY occupation), 2) AS percentage
FROM 
    sleep
GROUP BY 
    occupation, 
    sleepdisorder;
